
<div class="rect">    
{% assign maxRelated = 4 %}
{% assign minCommonTags =  1 %}
{% assign maxRelatedCounter = 0 %}
    
<h4 text-align: center>Related Ramblings</h4>
  {% for post in site.posts %}
    {% assign sameTagCount = 0 %}
    {% assign commonTags = '' %}
    {% for tag in post.tags %}
      {% if post.url != page.url %}
        {% if page.tags contains tag %}
          {% assign sameTagCount = sameTagCount | plus: 1 %}
          {% capture tagmarkup %} <span class="label label-default">{{ tag }}</span>{% endcapture %}
          {% assign commonTags = commonTags | append: tagmarkup %}
        {% endif %}
      {% endif %}
    {% endfor %} 
{% if sameTagCount >= minCommonTags %}

{% if post.category == "Writing" %}
<a href="{{site.url}}/{{post.url}}">
<div class="rel">
{% if post.tn %}
    <img width="100%" src="{{"/assets/img/index/" | prepend: site.baseurl | append : post.tn}}">
    <p>{{ post.title | truncate: 22 }}</p>
{% elsif post.img %}      
    <img width="100%" src="{{"/assets/img/post/" | prepend: site.baseurl | append : post.img}}">
    <p>{{ post.title | truncate: 22 }}</p>
{% else %}
    <div class="post-linkthumb"><h1 class="defaultpost"><i class="fa fa-glass" aria-hidden="true"></i></h1></div>
    <p>{{ post.title  | truncate: 22 }}</p>
    {% endif %}
</div>
</a>     
     
{% elsif post.category == "Linked" %}
<a href="{{site.url}}/{{post.url}}">
<div class="rel">
{% if post.tn %}
    <img width="100%" src="{{"/assets/img/index/" | prepend: site.baseurl | append : post.tn}}">
    <p>{{ post.title | truncate: 22 }}</p>
{% elsif post.img %}      
    <img width="100%" src="{{"/assets/img/post/" | prepend: site.baseurl | append : post.img}}">
    <p>{{ post.title | truncate: 22 }}</p>
{% else %}
    <div class="post-linkthumb"><h1 class="linkpost"><i class="fa fa-link" aria-hidden="true"></i></h1></div>
    <p>{{ post.title | truncate: 22 }}</p>
    {% endif %}
</div>
</a>    
     
{% elsif post.category == "Stuff" %}
<a href="{{site.url}}/{{post.url}}">
<div class="rel">
{% if post.tn %}
    <img class="relimg" src="{{"/assets/img/index/" | prepend: site.baseurl | append : post.tn}}">
    <p>{{ post.title | truncate: 22 }}</p>
{% elsif post.img %}      
    <img class= "relimg" src="{{"/assets/img/post/" | prepend: site.baseurl | append : post.img}}">
    <p>{{ post.title | truncate: 22 }}</p>
{% else %}
            <div class="post-linkthumb"><h1 class="stuffpost"><i class="fa fa-amazon" aria-hidden="true"></i></h1></div>
    <p>{{ post.title | truncate: 22 }}</p>
    {% endif %}
</div>
</a>          
{% elsif post.category == "Micro" %}
<a href="{{site.url}}/{{post.url}}">
<div class="rel">
{% if post.tn %}
    <img width="100%" src="{{"/assets/img/index/" | prepend: site.baseurl | append : post.tn}}">
    <p>{{ post.title | truncate: 22 }}</p>
{% elsif post.img %}      
    <img width="100%" src="{{"/assets/img/post/" | prepend: site.baseurl | append : post.img}}">
    <p>{{ post.title | truncate: 22 }}</p>
{% else %}
    <div class="post-linkthumb"><h1 class="micropost"><i class="fa fa-quote-left" aria-hidden="true"></i></h1></div>
    <p>{{ post.title | truncate: 22 }}</p>
    {% endif %}
</div>
</a>      
{% elsif post.category == "Video" %}
<a href="{{site.url}}/{{post.url}}">
<div class="rel">
{% if post.tn %}
    <img width="100%" src="{{"/assets/img/index/" | prepend: site.baseurl | append : post.tn}}">
    <p>{{ post.title | truncate: 22 }}</p>
{% elsif post.img %}      
    <img width="100%" src="{{"/assets/img/post/" | prepend: site.baseurl | append : post.img}}">
    <p>{{ post.title | truncate: 22 }}</p>
{% else %}
            <div class="post-linkthumb"><h1 class="youtubepost"><i class="fa fa-youtube" aria-hidden="true"></i></h1></div>
    <p>{{ post.title | truncate: 22 }}</p>
    {% endif %}
</div>
 </a>     
{% elsif post.category == "Social" %}
<a href="{{site.url}}/{{post.url}}">
<div class="rel">
{% if post.via == "Twitter" %}<div class="post-linkthumb"><h1 class="tweetpost"><a href="{{post.link}}"><i class="fa fa-twitter" aria-hidden="true"></i></a></h1></div>
    {% elsif post.via == "Instagram" %}
        {% if post.tn %}
    <img width="100%" src="{{"/assets/img/index/" | prepend: site.baseurl | append : post.tn}}">
    <p>{{ post.title | truncate: 22 }}</p>
{% elsif post.img %}      
    <img width="100%" src="{{"/assets/img/post/" | prepend: site.baseurl | append : post.img}}">
    <p>{{ post.title | truncate: 22 }}</p>
    {% endif %}
</div>
</a> 
    {% endif %}
{% endif %}            

      {% assign maxRelatedCounter = maxRelatedCounter | plus: 1 %}
      {% if maxRelatedCounter >= maxRelated %}
        {% break %}
      {% endif %}
    {% endif %}
  {% endfor %}
    </div>
